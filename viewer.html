<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iron Heist Poetry Viewer</title>
    <link rel="icon" href="poetry.png" type="image/x-icon" />
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Iron Heist Poetry Viewer">
    <meta property="og:description" content="Read soul-stirring poetry by Iron Heist (John Colt).">
    <meta property="og:image" content="https://yourwebsite.com/poetry.png">
    <meta property="og:url" content="https://yourwebsite.com/viewer.html">
    <meta property="og:type" content="website">
    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Iron Heist Poetry Viewer">
    <meta name="twitter:description" content="Read soul-stirring poetry by Iron Heist (John Colt).">
    <meta name="twitter:image" content="https://yourwebsite.com/poetry.png">
    <style>
        @font-face {
            font-family: 'KirimomiSwash';
            src: url('KirimomiSwash.ttf') format('truetype');
            font-display: swap;
        }

        body {
            font-family: 'KirimomiSwash', 'Georgia', serif;
            margin: 0;
            padding: 0;
            background: #f8f9fa;
            color: #343a40;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #121212 0%, #1a1a2e 100%);
            color: #d3d3d3;
        }

        header {
            background: #343a40;
            color: #fff;
            padding: 10px 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        body.dark-mode header {
            background: #1e1e1e;
        }

        header h1 {
            margin: 0;
            font-size: 1.5em;
            flex: 1;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #currentDateTime {
            font-size: 0.8em;
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 8px;
            border-radius: 5px;
        }

        .controls {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .controls button, .dark-mode-toggle {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: #fff;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, box-shadow 0.3s;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .controls button:hover, .dark-mode-toggle:hover {
            background: linear-gradient(135deg, #0056b3, #003f87);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
        }

        .dark-mode-toggle {
            width: 36px;
            height: 30px;
            padding: 0;
        }

        /* Scroll Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "↕️"; /* Vertical icon for 'off' */
            height: 20px;
            width: 20px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        input:checked + .slider {
            background: linear-gradient(135deg, #007bff, #0056b3);
        }

        input:checked + .slider:before {
            content: "↔️"; /* Horizontal icon for 'on' */
            transform: translateX(26px);
        }

        #pdfViewer {
            flex: 1;
            width: 100%;
            height: 100%;
            border: none;
            overflow: auto;
            position: relative;
        }

        /* Arrow Buttons for Horizontal Scrolling */
        .scroll-arrows {
            position: absolute;
            top: 50%;
            width: 100%;
            display: none; /* Hidden by default, shown in horizontal mode */
            justify-content: space-between;
            transform: translateY(-50%);
            pointer-events: none;
        }

        .scroll-arrow {
            background: rgba(0, 123, 255, 0.8);
            color: #fff;
            border: none;
            padding: 10px;
            font-size: 1.2em;
            cursor: pointer;
            pointer-events: auto;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        .scroll-arrow:hover {
            background: rgba(0, 86, 179, 0.8);
        }

        #scrollLeft {
            margin-left: 10px;
        }

        #scrollRight {
            margin-right: 10px;
        }

        #loadingOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        footer {
            background: #343a40;
            color: #fff;
            text-align: center;
            padding: 10px;
            font-size: 0.9em;
        }

        body.dark-mode footer {
            background: #1e1e1e;
        }

        footer a {
            color: #FFCA28;
            text-decoration: none;
        }

        body.dark-mode footer a {
            color: #FFD54F;
        }

        footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            header {
                padding: 8px 12px;
                flex-direction: column;
                align-items: flex-start;
            }
            .header-right {
                margin-top: 10px;
                width: 100%;
                justify-content: space-between;
            }
            #currentDateTime {
                font-size: 0.75em;
            }
            .controls {
                flex-wrap: wrap;
                justify-content: flex-end;
                width: 100%;
                gap: 6px;
            }
            .controls button, .dark-mode-toggle {
                padding: 4px 6px;
                font-size: 0.75em;
            }
            .dark-mode-toggle {
                width: 28px;
                height: 24px;
            }
            .switch {
                width: 40px;
                height: 20px;
            }
            .slider:before {
                height: 16px;
                width: 16px;
                left: 2px;
                bottom: 2px;
            }
            input:checked + .slider:before {
                transform: translateX(20px);
            }
            .scroll-arrow {
                width: 35px;
                height: 35px;
                font-size: 1em;
            }
        }

        @media (max-width: 480px) {
            header {
                padding: 6px 10px;
            }
            .header-right {
                flex-direction: column;
                align-items: flex-end;
                gap: 8px;
            }
            #currentDateTime {
                font-size: 0.65em;
            }
            .controls {
                gap: 5px;
            }
            .controls button, .dark-mode-toggle {
                padding: 3px 5px;
                font-size: 0.65em;
            }
            .dark-mode-toggle {
                width: 24px;
                height: 22px;
            }
            .switch {
                width: 36px;
                height: 18px;
            }
            .slider:before {
                height: 14px;
                width: 14px;
            }
            input:checked + .slider:before {
                transform: translateX(18px);
            }
            .scroll-arrow {
                width: 30px;
                height: 30px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body oncontextmenu="return false;">
    <header>
        <h1 id="pdfTitle">Loading...</h1>
        <div class="header-right">
            <div id="currentDateTime"></div>
            <div class="controls">
                <button onclick="sharePoem()" title="Share this poem" aria-label="Share this poem">Share</button>
                <button onclick="window.location.href='index.html'" title="Return to the main page" aria-label="Return to the main page">Back</button>
                <button class="dark-mode-toggle" tabindex="0" onclick="toggleDarkMode()" onkeydown="if(event.key === 'Enter') toggleDarkMode()" title="Toggle dark mode" aria-label="Toggle dark mode">🌙</button>
                <label class="switch" title="Toggle scroll direction" aria-label="Toggle scroll direction">
                    <input type="checkbox" id="scrollToggle" onchange="toggleScrollMode()">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </header>
    <div id="loadingOverlay">
        <div style="color: white; font-size: 1.2em;">Loading Poem...</div>
    </div>
    <iframe id="pdfViewer" loading="lazy"></iframe>
    <div class="scroll-arrows" id="scrollArrows">
        <button id="scrollLeft" class="scroll-arrow" onclick="scrollPDF('left')" title="Scroll left" aria-label="Scroll left">◄</button>
        <button id="scrollRight" class="scroll-arrow" onclick="scrollPDF('right')" title="Scroll right" aria-label="Scroll right">►</button>
    </div>
    <footer>
        © <span id="current-year"></span> Iron Heist (John Colt) | <a href="/cdn-cgi/l/email-protection#b5dcc7dadbddd0dcc6c183f5d2d8d4dcd99bd6dad8"><span class="__cf_email__" data-cfemail="18312a3736303d312b2c6e183f35393134763b3735">[email protected]</span></a>
    </footer>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
    <script>
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return decodeURIComponent(urlParams.get(param));
        }

        const pdfUrl = getQueryParam('pdf');
        const title = getQueryParam('title');
        const iframe = document.getElementById('pdfViewer');

        document.getElementById('pdfTitle').textContent = title || 'Poetry Viewer';

        const absolutePdfUrl = `https://ironheist.github.io/main/${pdfUrl}`;
        const viewerUrl = `https://mozilla.github.io/pdf.js/web/viewer.html?file=${encodeURIComponent(absolutePdfUrl)}`;
        iframe.src = viewerUrl;

        document.querySelector('meta[property="og:title"]').setAttribute('content', title || 'Iron Heist Poetry Viewer');
        document.querySelector('meta[name="twitter:title"]').setAttribute('content', title || 'Iron Heist Poetry Viewer');

        iframe.onload = () => {
            try {
                document.getElementById('loadingOverlay').style.display = 'none';
                trackRecentlyViewed();
                const scrollMode = localStorage.getItem('scrollMode') || 'vertical';
                applyScrollMode(scrollMode);
            } catch (error) {
                console.error("Error during iframe load:", error);
                document.getElementById('loadingOverlay').style.display = 'none';
            }
        };

        iframe.onerror = () => {
            console.error("Error loading iframe with PDF.js viewer.");
            document.getElementById('loadingOverlay').style.display = 'none';
            alert("Failed to load the poem. Please try again later.");
        };

        document.addEventListener('keydown', (event) => {
            if ((event.ctrlKey || event.metaKey) && event.key === 'p') {
                event.preventDefault();
            }
        });

        function sharePoem() {
            const url = window.location.href;
            if (navigator.share) {
                navigator.share({
                    title: document.getElementById('pdfTitle').textContent,
                    url: url
                }).catch(err => console.error('Share failed:', err));
            } else {
                navigator.clipboard.writeText(url).then(() => {
                    alert('Poem URL copied to clipboard!');
                }).catch(err => {
                    console.error('Failed to copy URL:', err);
                    alert('Failed to copy URL. Please copy manually: ' + url);
                });
            }
        }

        function trackRecentlyViewed() {
            try {
                const recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
                const poem = { title, pdfUrl };
                const index = recentlyViewed.findIndex(item => item.pdfUrl === pdfUrl);
                if (index !== -1) recentlyViewed.splice(index, 1);
                recentlyViewed.unshift(poem);
                if (recentlyViewed.length > 5) recentlyViewed.pop();
                localStorage.setItem('recentlyViewed', JSON.stringify(recentlyViewed));
            } catch (error) {
                console.error("Error tracking recently viewed:", error.message, error.stack);
            }
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const darkModeToggle = document.querySelector('.dark-mode-toggle');
            darkModeToggle.textContent = document.body.classList.contains('dark-mode') ? '☀️' : '🌙';
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }

        function toggleScrollMode() {
            const toggle = document.getElementById('scrollToggle');
            const newMode = toggle.checked ? 'horizontal' : 'vertical';
            localStorage.setItem('scrollMode', newMode);
            applyScrollMode(newMode);
        }

        function applyScrollMode(mode) {
            const iframe = document.getElementById('pdfViewer');
            const scrollArrows = document.getElementById('scrollArrows');
            const viewerDoc = iframe.contentDocument || iframe.contentWindow.document;
            const viewerContainer = viewerDoc.querySelector('#viewerContainer'); // Target PDF.js container
            if (viewerContainer) {
                if (mode === 'horizontal') {
                    viewerContainer.style.overflowX = 'auto';
                    viewerContainer.style.overflowY = 'hidden';
                    viewerContainer.style.whiteSpace = 'nowrap';
                    viewerDoc.querySelectorAll('.page').forEach(page => {
                        page.style.display = 'inline-block';
                        page.style.verticalAlign = 'top';
                        page.style.margin = '0 10px';
                    });
                    scrollArrows.style.display = 'flex';
                } else {
                    viewerContainer.style.overflowX = 'hidden';
                    viewerContainer.style.overflowY = 'auto';
                    viewerContainer.style.whiteSpace = 'normal';
                    viewerDoc.querySelectorAll('.page').forEach(page => {
                        page.style.display = 'block';
                        page.style.margin = '0 auto';
                    });
                    scrollArrows.style.display = 'none';
                }
            }
        }

        function scrollPDF(direction) {
            const iframe = document.getElementById('pdfViewer');
            const viewerDoc = iframe.contentDocument || iframe.contentWindow.document;
            const viewerContainer = viewerDoc.querySelector('#viewerContainer');
            if (viewerContainer) {
                const scrollAmount = direction === 'left' ? -300 : 300;
                viewerContainer.scrollLeft += scrollAmount;
            }
        }

        function updateDateTime() {
            const now = new Date();
            const date = now.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            const time = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit', 
                hour12: true 
            });
            document.getElementById('currentDateTime').textContent = `${date}, ${time}`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('current-year').textContent = new Date().getFullYear();
            if (localStorage.getItem('darkMode') === 'true') toggleDarkMode();
            updateDateTime();
            setInterval(updateDateTime, 1000);
            const scrollMode = localStorage.getItem('scrollMode') || 'vertical';
            document.getElementById('scrollToggle').checked = scrollMode === 'horizontal';
            // Delay applying scroll mode to ensure PDF.js is ready
            setTimeout(() => applyScrollMode(scrollMode), 500);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9298253a892d4525',t:'MTc0MzUxMTEyNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
